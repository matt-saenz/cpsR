---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cpsR

<!-- badges: start -->

[![CRAN status](https://www.r-pkg.org/badges/version/cpsR)](https://CRAN.R-project.org/package=cpsR)
[![R-CMD-check](https://github.com/matt-saenz/cpsR/workflows/R-CMD-check/badge.svg)](https://github.com/matt-saenz/cpsR/actions)
[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)

<!-- badges: end -->

## Overview

Load [Current Population Survey (CPS)](https://www.census.gov/programs-surveys/cps/about.html) microdata into R using the Census Bureau Data API, including [basic monthly CPS](https://www.census.gov/data/datasets/time-series/demo/cps/cps-basic.html) and [CPS ASEC](https://www.census.gov/data/datasets/time-series/demo/cps/cps-asec.html) microdata.

Note: This product uses the Census Bureau Data API but is not endorsed or certified by the Census Bureau.

## Installation

To install cpsR, run the following code:

``` r
install.packages("cpsR")
```

To install the development version of cpsR, run the following code:

``` r
# install.packages("devtools")
devtools::install_github("matt-saenz/cpsR")
```

## Census API key

Once you've installed cpsR, register for a [Census API key](https://api.census.gov/data/key_signup.html) if you don't already have one. Once you have your key, store it in an environment variable named `CENSUS_API_KEY` for safe and easy use. You can do this in two steps:

1. Run `usethis::edit_r_environ()` to open your `.Renviron` file
2. Add `CENSUS_API_KEY="your_key_here"` to your `.Renviron` file

This allows cpsR functions to automatically add your key to Census API requests (via `Sys.getenv("CENSUS_API_KEY")`). Compared to manually supplying your key with the `key` argument, using env var `CENSUS_API_KEY` has two main benefits:

1. Saves you from having to copy-paste your key around
2. Allows you to avoid including your key in scripts

Number two is particularly important if you plan to share your scripts with others or post your scripts online (e.g., on GitHub).

## Example

```{r example, message=FALSE}
library(cpsR)
library(dplyr)

sep21 <- get_basic(
  year = 2021,
  month = 9,
  vars = c("prpertyp", "prtage", "pemlr", "pwcmpwgt")
)

sep21

sep21 %>%
  filter(prpertyp == 2 & prtage >= 16) %>%
  summarize(
    pop16plus = sum(pwcmpwgt),
    employed = sum(pwcmpwgt[pemlr %in% 1:2])
  ) %>%
  mutate(epop_ratio = employed / pop16plus)
```
